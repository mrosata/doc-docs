{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Created by michael on 2/18/16.\n */\n\"use strict\";\n\nvar isObject = (!!isObject && typeof isObject === \"function\" ? isObject :\n    function isObject (...obj) {\n      obj.forEach((o)=> {\n        if (!o || typeof o !== \"object\")\n          return false;\n      });\n      return true;\n    }\n);\n\nclass ResponseUtils {\n\n  constructor () {\n\n  }\n\n  /**\n   * Figure out if obj is result of Facebook OAuth2 call. Then return\n   * an object with only the values required to send to DocDocs server.\n   *\n   * @param fbRespObj\n   * @return object|boolean Response object or false\n   */\n  static fbResp(fbRespObj) {\n    if (!isObject(fbRespObj))\n      return false;\n    if (!fbRespObj.status || fbRespObj.status === \"unknown\")\n      return false;\n    if (!fbRespObj.hasOwnProperty('authResponse') || !isObject(fbRespObj.authResponse))\n      return false;\n    let authResponse = fbRespObj.authResponse;\n    return {\n      type: 'fb',\n      user_id: authResponse.userID,\n      access_token: authResponse.accessToken,\n      expires_in: authResponse.expiresIn,\n      signed_request: authResponse.signedRequest\n    };\n  }\n\n  \n  /**\n   * Figure out if obj is result of Google OAuth2 call. Then return\n   * an object with only the values required to send to DocDocs server.\n   * \n   * @param gplusRespObj obj\n   * @return object|boolean Response object or false\n   */\n  static gplusResp(gplusRespObj) {\n    if (!isObject(gplusRespObj))\n      return false;\n    if (!gplusRespObj.id_token || !gplusRespObj.code || !gplusRespObj.client_id)\n      return false;\n\n    let resp = {\n      type: 'google'\n    };\n    resp.client_id = gplusRespObj.client_id;\n    resp.code = gplusRespObj.code;\n    resp.id_token = gplusRespObj.id_token;\n\n    return resp;\n  }\n\n  /**\n   * Figure out if obj is result of GitHub OAuth2 call. Then return\n   * an object with only the values required to send to DocDocs server.\n   * \n   * @param githubRespObj\n   * @return object|boolean Response object or false\n   */\n  static githubResp(githubRespObj) {\n    if (!isObject(githubRespObj))\n      return false;\n  }\n\n}\nvar respUtil = new ResponseUtils();\n\n\n/**\n * After page load run Foundation and handle events\n */\njQuery(function ($) {\n  var Foundation = $(document).foundation();\n\n  // Get the State for the App set through the templating engine\n  let ddStateElem = $('[data-doc-doc-state-object]');\n  const _STATE = (ddStateElem.length ? ddStateElem.data('appState') : \"\");\n\n  /**\n   * Open Modals with Errors or Flash Message Modals on load\n   *\n   * Check if a form inside of a reveal modal was submitted with errors\n   * and if so then have it be open. If no forms have error messages then\n   * this function will also check for Flask Flash Messages and show them\n   * inside modals.\n   */\n  function openFlashMessageAndErrorModalsOnLoad () {\n    var formsWithErrors = $('.reveal[data-errors-present=\"true\"]'),\n        flaskFlashMessages = $('.flash-messages .reveal');\n    if (formsWithErrors.length) {\n      formsWithErrors.foundation(\"open\");\n    } else if (flaskFlashMessages.length) {\n      // We only pop open flash messages if there aren't any forms with errors open.\n      flaskFlashMessages.each(function() {\n        $(this).foundation(\"open\");\n      });\n    }\n  }\n  openFlashMessageAndErrorModalsOnLoad();\n\n  /**\n   * Log User out of the app (including fb or any other oauth).\n   */\n  window.accountDocDocsLogoff = function() {\n    FB.logout();\n    window.location = \"/logout\";\n  };\n\n  window.facebookDocDocsLogin = function() {\n\n    FB.login(function(fbObject) {\n\n      let fbUserInfo = ResponseUtils.fbResp(fbObject);\n      if (!fbUserInfo || !isObject(fbUserInfo))\n        return false;\n\n      // Put the state of app from page into our response.\n      fbUserInfo._state = _STATE;\n\n      $.ajax({\n        url: \"/api/login\",\n        type: \"post\",\n        data: JSON.stringify(fbUserInfo),\n        contentType: \"application/json\",\n        success(result) {\n          // handle response from our own app\n          if (isObject(result) && result.status.toLowerCase() === \"success\") {\n            window.location = result.data.location;\n          }\n          else {\n            // The login failed somehow on server side\n            alert(\"Hew Son, Ve Ack a Pro Blah!\");\n          }\n        },\n        error(err) {\n          console.error(err);\n        }\n      });\n    }, {scope: 'email,public_profile,user_friends'});\n\n  };\n\n\n  window.googleDocDocsLogin = function(authResult) {\n    console.debug(authResult);\n    authResult = ResponseUtils.gplusResp(authResult);\n    if (!authResult['code'])\n      return false;\n\n    authResult._state = _STATE;\n\n    $.ajax({\n      type: \"post\",\n      url: \"/api/login\",\n      dataType: \"json\",\n      contentType: \"application/json\",\n      data: JSON.stringify(authResult),\n      success(result) {\n        // handle response from our own app\n        if (isObject(result) && result.status.toLowerCase() === \"success\") {\n          window.location = result.data.location;\n        }\n        else {\n          // The login failed somehow on server side\n          alert(\"Hew Son, Ve Ack a Pro Blah!\");\n        }\n      }\n    });\n\n  };\n\n\n  window.githubDocDocsStep1 = function() {\n    // Unlike Facebook and Google OAuth2, Doc Docs will create the initial request to ask the\n    // users for permission to authenticate them using their GitHub account.\n    // I put all the needed information inside the template (sort of like Google + FB)\n    let githubBtn = document.querySelector(\".github-signin\");\n    let [scope, client_id, redirect_uri] = [\n      githubBtn.dataset['scope'],\n      githubBtn.dataset['clientid'],\n      `${window.location.origin}${githubBtn.dataset['redirecturi']}`\n    ];\n\n    // With the GitHub OAuth we will actually let the page redirect and then afterwards it\n    // will redirect back to us.\n    window.location = \"https://github.com/login/oauth/authorize\"\n      + `?scope=${scope}&client_id=${client_id}&state=${_STATE}&redirecturi=${redirect_uri}`;\n  };\n});\n"],"sourceRoot":"/source/"}